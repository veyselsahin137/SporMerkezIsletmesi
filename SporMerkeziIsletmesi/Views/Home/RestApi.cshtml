@model IEnumerable<SporMerkeziIsletmesi.Models.Hizmet>

@{
    ViewData["Title"] = "REST API - Antrenörler";
}

<div class="container mt-4">
    <h2 class="mb-4">REST API - Antrenörler</h2>

    <p class="text-muted">
        Bu sayfada antrenör verileri
        <strong>/api/AntrenorApi</strong> ve
        <strong>/api/AntrenorApi/ByHizmet/{hizmetId}</strong>
        <br />
        endpoint’lerinden <strong>AJAX (fetch)</strong> ile çekilerek gösterilmektedir.
    </p>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Sorgu Seçenekleri</h5>

            <div class="mb-3">
                <button id="btnTum" class="btn btn-primary me-2">
                    Tüm Antrenörleri Getir
                </button>

                <span class="text-muted">
                    (GET <code>/api/AntrenorApi</code>)
                </span>
            </div>

            <hr />

            <div class="row align-items-end">
                <div class="col-md-6">
                    <label for="hizmetSelect" class="form-label">Hizmete Göre Antrenör Filtrele</label>
                    <select id="hizmetSelect" class="form-select">
                        <option value="">-- Hizmet Seçin --</option>
                        @foreach (var h in Model)
                        {
                            <option value="@h.HizmetID">
                                @h.HizmetAdi (@h.SureDakika dk, @h.Ucret.ToString("0.00") ₺)
                            </option>
                        }
                    </select>
                </div>
                <div class="col-md-3 mt-3 mt-md-0">
                    <button id="btnHizmeteGore" class="btn btn-outline-primary w-100">
                        Seçili Hizmete Göre Getir
                    </button>
                </div>
                <div class="col-md-3 mt-3 mt-md-0 text-muted small">
                    (GET <code>/api/AntrenorApi/ByHizmet/{{hizmetId}}</code>)
                </div>
            </div>
        </div>
    </div>

    <div id="antrenor-listesi" class="row g-3">
        <!-- JavaScript ile doldurulacak -->
    </div>

    <div id="antrenor-hata" class="alert alert-danger d-none mt-3">
        Antrenör bilgileri yüklenirken bir hata oluştu.
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const listeDiv = document.getElementById('antrenor-listesi');
            const hataDiv = document.getElementById('antrenor-hata');
            const btnTum = document.getElementById('btnTum');
            const btnHizmeteGore = document.getElementById('btnHizmeteGore');
            const hizmetSelect = document.getElementById('hizmetSelect');

            function temizleHata() {
                hataDiv.classList.add('d-none');
            }

            function gosterHata(mesaj) {
                hataDiv.textContent = mesaj;
                hataDiv.classList.remove('d-none');
            }

            // ⭐ Ortak render fonksiyonu: gelen listeyi kartlara çevir
            function renderAntrenorler(data) {
                listeDiv.innerHTML = '';

                if (!data || data.length === 0) {
                    listeDiv.innerHTML = '<p>Sonuç bulunamadı.</p>';
                    return;
                }

                data.forEach(a => {
                    const col = document.createElement('div');
                    col.className = 'col-md-4';

                    // JSON alanları (camelCase):
                    // Tüm antrenörler endpoint'i:
                    //  antrenorID, ad, soyad, adSoyad, uzmanlikAlani, telefon, email, aktifMi
                    //
                    // ByHizmet endpoint'i:
                    //  antrenorID, ad, soyad, adSoyad, uzmanlikAlani,
                    //  hizmetID, hizmetAdi, sureDakika, ucret

                    const adSoyad = a.adSoyad ?? (a.ad + ' ' + a.soyad);
                    const uzmanlik = a.uzmanlikAlani ?? '';
                    const email = a.email ?? '';
                    const telefon = a.telefon ?? '';
                    const aktifMi = (a.aktifMi !== undefined) ? a.aktifMi : true; // yoksa true varsayalım

                    // Hizmet bilgisi varsa göster
                    const hizmetBilgi = a.hizmetAdi
                        ? `<hr/>
                           <strong>Hizmet:</strong> ${a.hizmetAdi} (${a.sureDakika} dk, ${a.ucret} ₺)`
                        : '';

                    col.innerHTML = `
                        <div class="card h-100 shadow-sm">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${adSoyad}</h5>
                                <p class="card-text flex-grow-1">
                                    Uzmanlık: ${uzmanlik}<br/>
                                    ${email ? 'E-posta: ' + email + '<br/>' : ''}
                                    ${telefon ? 'Telefon: ' + telefon + '<br/>' : ''}
                                    ${hizmetBilgi}
                                </p>
                                <span class="badge ${aktifMi ? 'bg-success' : 'bg-secondary'} mt-auto">
                                    ${aktifMi ? 'Aktif' : 'Pasif'}
                                </span>
                            </div>
                        </div>
                    `;

                    listeDiv.appendChild(col);
                });
            }

            // ⭐ 1) Tüm antrenörleri getir
            btnTum.addEventListener('click', function () {
                temizleHata();
                listeDiv.innerHTML = '<p>Yükleniyor...</p>';

                fetch('/api/AntrenorApi')
                    .then(r => {
                        if (!r.ok) throw new Error('HTTP ' + r.status);
                        return r.json();
                    })
                    .then(data => renderAntrenorler(data))
                    .catch(err => {
                        console.error(err);
                        gosterHata('Tüm antrenörler yüklenirken bir hata oluştu.');
                    });
            });

            // ⭐ 2) Seçili hizmeti veren antrenörleri getir
            btnHizmeteGore.addEventListener('click', function () {
                temizleHata();

                const hizmetId = hizmetSelect.value;
                if (!hizmetId) {
                    gosterHata('Lütfen önce bir hizmet seçin.');
                    return;
                }

                listeDiv.innerHTML = '<p>Yükleniyor...</p>';

                fetch(`/api/AntrenorApi/ByHizmet/${hizmetId}`)
                    .then(r => {
                        if (!r.ok) throw new Error('HTTP ' + r.status);
                        return r.json();
                    })
                    .then(data => renderAntrenorler(data))
                    .catch(err => {
                        console.error(err);
                        gosterHata('Hizmete göre antrenörler yüklenirken bir hata oluştu.');
                    });
            });
        });
    </script>
}
